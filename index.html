<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Birthday, my love! üéâ</title>
  <meta name="description" content="made with ‚ù§Ô∏è by Luc√≠a." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéÇ</text></svg>">
  <style>
    :root{
      --bg: #0b1220;
      --card: #131b2d;
      --text: #e6edf7;
      --muted: #9fb0d0;
      --brand: #7c9cf5;
      --brand-2:#70e1d2;
      --shadow: 0 10px 25px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 10% -10%, rgba(124,156,245,.35), transparent 60%),
                  radial-gradient(1200px 800px at 90% -10%, rgba(112,225,210,.25), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    a{color:var(--brand)}
    .wrap{max-width:1000px; margin:0 auto; padding:28px;}
    header{
      position:sticky; top:0; z-index:10; backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(11,18,32,.9), rgba(11,18,32,.6));
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .nav{display:flex; align-items:center; gap:14px;}
    .logo{display:flex; align-items:center; gap:10px; font-weight:700}
    .logo-badge{width:34px; height:34px; border-radius:10px; display:grid; place-items:center; background:
      linear-gradient(135deg, var(--brand), var(--brand-2)); box-shadow:var(--shadow)}
    .tabs{display:flex; gap:8px; flex-wrap:wrap; margin-left:auto}
    .tab{appearance:none; border:1px solid rgba(255,255,255,.08); background:rgba(255,255,255,.03);
      color:var(--text); padding:8px 12px; border-radius:12px; cursor:pointer; transition:.2s}
    .tab[aria-current="page"], .tab:hover{border-color:rgba(255,255,255,.18); background:rgba(255,255,255,.08)}
    .tabs.locked{pointer-events:none; opacity:.5}

    .hero{margin:24px 0 16px; display:grid; grid-template-columns: 1.1fr .9fr; gap:18px}
    @media (max-width:860px){ .hero{grid-template-columns:1fr} }

    .card{background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); padding:18px; border-radius:var(--radius); box-shadow:var(--shadow)}
    .title{font-size: clamp(24px, 4vw, 42px); margin:0 0 6px}
    .subtitle{color:var(--muted); margin-top:0}

    .grid{display:grid; grid-template-columns: repeat(12, 1fr); gap:12px}
    .col-12{grid-column: span 12}
    .col-6{grid-column: span 6}
    @media (max-width:760px){ .col-6{grid-column: span 12} }

    .btn{display:inline-flex; align-items:center; gap:8px; border:1px solid rgba(255,255,255,.12);
      padding:10px 14px; border-radius:12px; background:rgba(255,255,255,.04); color:var(--text);
      text-decoration:none; cursor:pointer; transition:.2s}
    .btn:hover{background:rgba(255,255,255,.08)}

    .pill{display:inline-block; padding:6px 10px; border-radius:999px; background:rgba(124,156,245,.15);
      border:1px solid rgba(124,156,245,.35); color:#cfe0ff; font-size:12px}

    /* Masonry-style responsive columns */
    .gallery{
      column-count: 2; column-gap: 12px;
    }
    @media (max-width: 640px){
      .gallery{ column-count: 1; }
    }
    @media (min-width: 1100px){
      .gallery{ column-count: 3; }
    }

    .gallery-item{
      break-inside: avoid; -webkit-column-break-inside: avoid; -moz-column-break-inside: avoid;
      margin-bottom: 12px;
    }
    .gallery img{
      width: 100%; height: auto; display: block; object-fit: cover;
      border-radius: 14px; border: 1px solid rgba(255,255,255,.08);
      opacity: 0; transition: opacity .35s ease; /* fade-in */
    }
    .gallery img.is-visible{ opacity: 1; }

    footer{opacity:.7; text-align:center; padding:30px}
    .hide{display:none}
  </style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="logo">
        <div class="logo-badge">üéâ</div>
        <div>Matt‚Äôs <span style="color:var(--brand)">Birthday</span></div>
      </div>
      <nav class="tabs" aria-label="Main" id="tabs">
        <a class="tab" href="#home">Home</a>
        <a class="tab" href="#timeline">Timeline</a>
        <a class="tab" href="#memories">Memories</a>
        <a class="tab" href="#messages">Messages</a>
        <a class="tab" href="#presents">Presents</a>
        <a class="tab" href="#about">About</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <!-- BIRTHDAY GATE (shown before the date) -->
    <section id="gate" class="view">
      <div class="card">
        <p class="pill">Open on the 23rd! </p>
        <h1 class="title" style="margin-top:6px">Not yet‚Ä¶ but almost!</h1>
        <p class="subtitle">Come back on <strong>23rd September</strong> to see your surprise site.</p>
        <div class="card" style="margin-top:14px">
          <h3 style="margin:.2rem 0 6px">Countdown</h3>
          <div id="gateCountdown" style="font-size:28px; margin:12px 0 4px">‚Äî</div>
          <p class="subtitle" style="margin-top:6px">This page will unlock automatically.</p>
        </div>
      </div>
    </section>

    <!-- HOME -->
    <section id="home" class="view hide">
      <div class="hero">
        <div class="card">
          <p class="pill">Surprise site</p>
          <h1 class="title">Happy 28th, pretty face! üßÅ</h1>
          <p class="subtitle">Here‚Äôs to another wonderful year ahead!</p>
          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:14px">
            <button class="btn" id="confettiBtn">üéä Launch confetti</button>
            <a class="btn" href="#memories"> See some lovely memories</a>
            <a class="btn" href="#messages"> We just want to say... </a>
          </div>
        </div>
        <div class="card">
          <h3>What‚Äôs inside?</h3>
          <p class="subtitle">Timeline, memories, messages, and a presents picker!</p>
        </div>
      </div>
    </section>

    <!-- TIMELINE -->
    <section id="timeline" class="view hide">
      <div class="card">
        <h2>Timeline</h2>
        <div class="grid">
          <div class="col-6 card"><h3>2020 ‚Äî First nights together‚Ä¶</h3><p>Not too much fun, but fun enough!</p></div>
          <div class="col-6 card"><h3>2021 ‚Äî London</h3><p>Leeds was great, but London made us stronger.</p></div>
          <div class="col-6 card"><h3>2022 ‚Äî Leyton!</h3><p>We combined our Kallaxes and made a home ‚ù§Ô∏è</p></div>
          <div class="col-6 card"><h3>2023 ‚Äî Lots of memories!</h3><p>We kept exploring and making the most of our days</p></div>
          <div class="col-6 card"><h3>2024 ‚Äî Casita</h3><p>Committed for the next 34.5 years! </p></div>
          <div class="col-6 card"><h3>2025 ‚Äî Maya</h3><p>Our little love, responsibility, and joy </p></div>
        </div>
      </div>
    </section>

    <!-- MEMORIES -->
    <section id="memories" class="view hide">
      <div class="card">
        <h2>Memories</h2>
        <div class="gallery" id="gallery"></div>
        <div id="gallery-sentinel" class="subtitle" style="text-align:center;margin-top:10px;">Loading more‚Ä¶</div>
      </div>
    </section>

    <!-- MESSAGES -->
    <section id="messages" class="view hide">
      <div class="card">
        <h2>Messages for Matt</h2>
        <p class="subtitle">Notes from Luc√≠a (and Maya üêæ)</p>
        <div id="messageList" class="grid"></div>
      </div>
    </section>

    <!-- PRESENTS -->
    <section id="presents" class="view hide">
      <div class="card">
        <h2>Presents üéÅ</h2>
        <p class="subtitle">It‚Äôs always hard to choose which present to open first, so let fate decide! Each gift is labeled 1‚Äì15. Press the button to get the next number </p>
        <div style="display:flex; gap:10px; flex-wrap:wrap; margin:12px 0">
          <button class="btn" id="drawBtn">üé≤ Pick the next number</button>
          <button class="btn" id="resetBtn" title="Only for Luc√≠a">‚Ü∫ Reset (for Luc√≠a)</button>
        </div>
        <div class="card" style="margin-top:10px">
          <div><strong>Next number:</strong> <span id="currentPick" class="pill">‚Äî</span></div>
          <div style="margin-top:8px"><strong>Already opened:</strong> <span id="openedList" class="subtitle">‚Äî</span></div>
          <div style="margin-top:8px"><strong>Remaining:</strong> <span id="remainingCount" class="subtitle">15</span></div>
        </div>
      </div>
    </section>

    <!-- ABOUT -->
    <section id="about" class="view hide">
      <div class="card">
        <h2>About this site</h2>
        <p>Made with ‚ù§Ô∏è by Luc√≠a. Built with plain HTML, CSS & a pinch of JS. Hosted on GitHub Pages.</p>
      </div>
    </section>
  </main>

  <footer>
    Made with ‚ù§Ô∏è by Luc√≠a ¬∑ <span id="year"></span>
  </footer>

  <script>
    // ====== CONFIG ======
    const UNLOCK_AT = new Date('2025-09-23T08:00:00'); // local time of the viewer

    // ====== Tiny router (hash-based) ======
    const tabs = Array.from(document.querySelectorAll('.tab'));
    const views = Array.from(document.querySelectorAll('.view'));
    const tabsEl = document.getElementById('tabs');

    function showView(hash){
      const id = (hash || location.hash || '#home').replace('#','');
      views.forEach(v => v.classList.toggle('hide', v.id !== id));
      tabs.forEach(t => t.setAttribute('aria-current', t.getAttribute('href') === '#' + id ? 'page' : 'false'));
      if(!location.hash) history.replaceState(null, '', '#home');
    }

    function isLocked(){
      return new Date() < UNLOCK_AT;
    }

    function lockUI(){
      tabsEl.classList.add('locked');
      // Force show gate, block hash navigation
      showView('#gate');
    }

    function unlockUI(){
      tabsEl.classList.remove('locked');
      showView('#home');
    }

    window.addEventListener('hashchange', () => {
      if(isLocked()){
        // Always keep user on gate until the time arrives
        history.replaceState(null, '', '#gate');
        showView('#gate');
      } else {
        showView(location.hash);
      }
    });

    // Initial lock state
    if(isLocked()) lockUI(); else unlockUI();

    // ====== Gate countdown & auto-unlock ======
    const gateEl = document.getElementById('gateCountdown');
    function gateTick(){
      const now = new Date();
      const diff = UNLOCK_AT - now;
      if(diff <= 0){
        unlockUI();
        return;
      }
      const d = Math.floor(diff/86400000);
      const h = Math.floor((diff%86400000)/3600000);
      const m = Math.floor((diff%3600000)/60000);
      gateEl.textContent = `${d}d ${h}h ${m}m`;
      // Keep trying; once it's time, unlockUI() will trigger
      setTimeout(gateTick, 30000);
    }
    if(isLocked()) gateTick();

    // ====== Confetti ======
    document.getElementById('confettiBtn')?.addEventListener('click', () => {
      for(let i=0;i<40;i++){
        const s = document.createElement('div');
        s.textContent = ['üéà','üéä','üéâ','‚ú®'][Math.floor(Math.random()*4)];
        Object.assign(s.style,{position:'fixed',left:(Math.random()*100)+'vw',top:'-10vh',fontSize:(16+Math.random()*24)+'px',transition:'transform 2.2s ease-out,opacity 2.2s',zIndex:9999});
        document.body.appendChild(s);
        requestAnimationFrame(()=>{s.style.transform=`translateY(110vh) rotate(${Math.random()*720-360}deg)`;s.style.opacity=0;});
        setTimeout(()=>s.remove(),2500);
      }
    });

    // ====== Messages ======
    const MESSAGES = [
      {name:'Luc√≠a',date:'2025-09-23',message:"I love you so much, let's make lots of new memories this year"},
      {name:'Maya üêæ',date:'2025-09-23',message:"Woof, woof!"}
    ];
    const escapeHTML = s => String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    document.getElementById('messageList').innerHTML = MESSAGES.map(m => `
      <div class="col-6">
        <div class="card">
          <div style="display:flex;justify-content:space-between">
            <strong>${escapeHTML(m.name)}</strong>
            <span class="subtitle">${escapeHTML(m.date)}</span>
          </div>
          <p>${escapeHTML(m.message)}</p>
        </div>
      </div>
    `).join('');

    // ====== Gallery (60 JPGs named matt_1.jpg ... matt_60.jpg), shuffled + fade-in ======
    const GALLERY_IMAGES = Array.from({length:60}, (_,i) => `images/matt_${i+1}.jpg`);
    const SHUFFLED_IMAGES = GALLERY_IMAGES.sort(() => Math.random() - 0.5);
    const BATCH_SIZE = 10;
    let galleryIndex = 0, observer;

    function renderNextBatch(){
      const gallery = document.getElementById('gallery');
      const slice = SHUFFLED_IMAGES.slice(galleryIndex, galleryIndex + BATCH_SIZE);
      slice.forEach((src,i) => {
        const wrap = document.createElement('div');
        wrap.className = 'gallery-item';
        const img = document.createElement('img');
        img.src = src;
        img.alt = 'Memory ' + (galleryIndex + i + 1);
        img.loading = 'lazy';
        img.addEventListener('load', () => img.classList.add('is-visible')); // fade-in
        wrap.appendChild(img);
        gallery.appendChild(wrap);
      });
      galleryIndex += slice.length;
      if(galleryIndex >= SHUFFLED_IMAGES.length){
        const sentinel = document.getElementById('gallery-sentinel');
        if (sentinel) sentinel.style.display = 'none';
        if (observer) observer.disconnect();
      }
    }
    // Only try to render gallery when not locked (so the gate stays clean)
    if(!isLocked()){
      renderNextBatch();
      observer = new IntersectionObserver(entries => {
        entries.forEach(e => { if(e.isIntersecting) renderNextBatch(); });
      }, { rootMargin:'400px 0px' });
      observer.observe(document.getElementById('gallery-sentinel'));
    } else {
      // When it unlocks, start the gallery
      const startGalleryAfterUnlock = setInterval(() => {
        if(!isLocked()){
          clearInterval(startGalleryAfterUnlock);
          renderNextBatch();
          observer = new IntersectionObserver(entries => {
            entries.forEach(e => { if(e.isIntersecting) renderNextBatch(); });
          }, { rootMargin:'400px 0px' });
          observer.observe(document.getElementById('gallery-sentinel'));
        }
      }, 1000);
    }

    // ====== Presents (1..15, no repeats, persisted) ======
    const STORE_KEY = 'presents_opened_v1';
    const TOTAL_PRESENTS = 15;

    function getOpened(){
      try{ return JSON.parse(localStorage.getItem(STORE_KEY)) || []; }
      catch(e){ return []; }
    }
    function setOpened(arr){
      localStorage.setItem(STORE_KEY, JSON.stringify(arr));
    }

    function getRemaining(){
      const opened = new Set(getOpened());
      return Array.from({length:TOTAL_PRESENTS}, (_,i)=>i+1).filter(n => !opened.has(n));
    }

    function drawNext(){
      const remaining = getRemaining();
      if(remaining.length === 0) return null;
      const pick = remaining[Math.floor(Math.random()*remaining.length)];
      const opened = getOpened();
      opened.push(pick);
      setOpened(opened);
      return pick;
    }

    function renderPresentsState(latest = null){
      const opened = getOpened().sort((a,b)=>a-b);
      const remaining = getRemaining();
      document.getElementById('currentPick').textContent = latest ?? '‚Äî';
      document.getElementById('openedList').textContent = opened.length ? opened.join(', ') : '‚Äî';
      document.getElementById('remainingCount').textContent = remaining.length;
    }

    document.getElementById('drawBtn')?.addEventListener('click', () => {
      const pick = drawNext();
      if(pick === null){
        document.getElementById('currentPick').textContent = 'All done! üéÅ';
      } else {
        document.getElementById('currentPick').textContent = pick;
      }
      renderPresentsState(pick ?? null);
    });

    document.getElementById('resetBtn')?.addEventListener('click', () => {
      if(confirm('Reset the presents list? (Only for Luc√≠a)')){
        localStorage.removeItem(STORE_KEY);
        renderPresentsState(null);
      }
    });

    // Initial render
    renderPresentsState(null);

    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
